{"version":3,"file":"ClientSettings.js","names":["ClientSettings","localToken","localStorage","getItem","token","replace","options","value","translation","_React$useState","React","useState","contact_email","id","model_id","name","stats","_React$useState2","_slicedToArray","client","setClient","emailRegex","RegExp","secondPartRegex","_React$useState3","_React$useState4","isValidEmail","setIsValidEmail","_React$useState5","_React$useState6","emailWarningMessage","setEmailWarningMessage","useEffect","test","includes","slice","concat","secondPart","split","invalidCharacterMatch","match","invalidCharacter","updateClient","headers","fetch","method","body","JSON","stringify","error","console","is_sharing_enabled","onClientNameChange","event","_objectSpread","target","onClientMailChange","onShareStatsChange","parse","tempClientData","fetchClientData","then","response","json","data","dataOf","clients","fetchStats","Promise","all","createElement","className","i18next","t","onSubmit","InputWithIcon","hasToBeFilled","icon","label","onChange","EmailInput","isCorrectlyFilled","title","Select","toString","disabled"],"sources":["../../../component/ClientSettings/ClientSettings.tsx"],"sourcesContent":["import React from 'react'\r\nimport i18next from \"ng_client/node_modules/i18next/i18next.js\";\r\nimport InputWithIcon from 'ng_client/component/Component/Inputs/InputWithIcon/InputWithIcon';\r\nimport EmailInput from 'ng_client/component/Component/Inputs/EmailInput/EmailInput'\r\nimport Select from 'ng_client/component/Component/Selects/Select/Select'\r\n\r\nimport {Client} from \"ng_client/component/interface/instanceInterface\"\r\n\r\nconst ClientSettings = () => {\r\n\r\n  const localToken = localStorage.getItem('ls.auth_token');\r\n  let token;\r\n  if (localToken !== null) {\r\n   token = localToken.replace(/\"/g, '');\r\n  }\r\n\r\n  const options = [\r\n    { value: 'true', translation: 'I agree' },\r\n    { value: 'false', translation: 'I donâ€™t agree' }\r\n  ];\r\n\r\n  const [client, setClient] = React.useState<Client>({\r\n    contact_email: '',\r\n    id: 0,\r\n    model_id: 0,\r\n    name: '',\r\n    stats: false,\r\n  });\r\n\r\n  const emailRegex = new RegExp('^[a-zA-Z0-9.!#$%&\\'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\\.[a-zA-Z0-9-]+)*$');\r\n  const secondPartRegex = new RegExp('^[a-zA-Z0-9.]+$');\r\n\r\n\r\n\r\n  const [isValidEmail, setIsValidEmail] = React.useState(true)\r\n  const [emailWarningMessage, setEmailWarningMessage] = React.useState('')\r\n\r\n\r\n\r\n  React.useEffect(() => {\r\n/*     console.log(client.contact_email)\r\n    console.log(secondPartRegex.test(client.contact_email.split('@')[1])) */\r\n\r\n    if (client.contact_email === '') {\r\n      setIsValidEmail(false)\r\n      setEmailWarningMessage('Please fill out this field')\r\n    }\r\n    else {\r\n      if (emailRegex.test(client.contact_email)) {\r\n        setIsValidEmail(true)\r\n        setEmailWarningMessage('')\r\n      }\r\n      else {\r\n        setIsValidEmail(false)\r\n/*         console.log(client.contact_email.includes('@'))\r\n        console.log(client.contact_email.slice(-1)) */\r\n        if (client.contact_email.includes('@')) {\r\n          if (client.contact_email.slice(-1) === '@') {\r\n            setEmailWarningMessage(`Please enter a part following \\'@\\'. \\'${client.contact_email}\\' is complete.`)\r\n          }\r\n          else if(client.contact_email.slice(-1) === '.'){\r\n            const secondPart = client.contact_email.split('@')[1]\r\n            setEmailWarningMessage(`\\'.\\' is used at a wrong position in \\'${secondPart}\\'`)\r\n          }\r\n          else if(!secondPartRegex.test(client.contact_email.split('@')[1])){\r\n            const secondPart = client.contact_email.split('@')[1];\r\n            const invalidCharacterMatch = secondPart.match(/[^A-Za-z0-9.]/);\r\n            let invalidCharacter;\r\n            if (invalidCharacterMatch !== null) {\r\n               invalidCharacter = invalidCharacterMatch[0];\r\n              // Continue with the rest of your code\r\n            }            setEmailWarningMessage(`A part following \\'@\\' should not contain the symbol \\'${invalidCharacter}\\'`);\r\n          }\r\n        }\r\n        else {\r\n          setEmailWarningMessage(`Please include an \\'@\\' in the email adress. \\'${client.contact_email}\\' is missing an \\'@\\'.`)\r\n        }\r\n      }\r\n    }\r\n\r\n  }, [client.contact_email])\r\n\r\n\r\n  function updateClient() {\r\n    if (client.id > 0) {\r\n      const headers = {\r\n        'Accept': 'application/json, text/plain, */*',\r\n        'Content-Type': 'application/json;charset=UTF-8',\r\n      };\r\n      \r\n      if (token !== null) {\r\n        headers['Token'] = token;\r\n      }\r\n      \r\n      fetch('api/client/' + client.id, {\r\n        method: 'PATCH',\r\n        headers,\r\n        body: JSON.stringify(client)\r\n      })\r\n        .catch(error => {\r\n          console.error(error);\r\n        });\r\n\r\n      fetch('api/stats/general-settings/', {\r\n        method: 'PATCH',\r\n        headers,\r\n        body: JSON.stringify({ is_sharing_enabled: client.stats })\r\n      })\r\n        .catch(error => {\r\n          console.error(error)\r\n        })\r\n    }\r\n  }\r\n\r\n  function onClientNameChange(event) {\r\n    setClient({ ...client, name: event.target.value })\r\n  }\r\n\r\n  function onClientMailChange(event) {\r\n    setClient({ ...client, contact_email: event.target.value })\r\n  }\r\n\r\n  function onShareStatsChange(event) {\r\n    setClient({ ...client, stats: JSON.parse(event.target.value) })\r\n  }\r\n\r\n  React.useEffect(() => {\r\n/*     let tempClientData: {\r\n      contact_email: string;\r\n      id: number;\r\n      model_id: number;\r\n      name: string;\r\n      stats: boolean;\r\n    } = {\r\n      contact_email: '',\r\n      id: 0,\r\n      model_id: 0,\r\n      name: '',\r\n      stats: false,\r\n    }; */\r\n\r\n\r\n    let tempClientData;\r\n\r\n    const headers = {}\r\n    if(token !== null){\r\nheaders['Token'] = token\r\n    }\r\n\r\n    const fetchClientData = fetch('api/client', {\r\n      headers\r\n    })\r\n      .then(response => response.json())\r\n      .then(data => {\r\n        const dataOf = data.clients[0];\r\n        tempClientData = { ...tempClientData, ...dataOf};\r\n      })\r\n      .catch(error => console.error(error));\r\n\r\n    const fetchStats = fetch('api/stats/general-settings/', {\r\n      headers\r\n    })\r\n      .then(response => response.json())\r\n      .then(data => {\r\n        const stats = data.data.is_sharing_enabled;\r\n        tempClientData = { ...tempClientData, stats };\r\n      })\r\n      .catch(error => console.error(error));\r\n\r\n    Promise.all([fetchClientData, fetchStats])\r\n      .then(() => {\r\n        setClient(tempClientData);\r\n      });\r\n  }, []);\r\n\r\n\r\n  return (\r\n    <div className=\"m-2\">\r\n      <div className=\"card\">\r\n        <div className=\"card-body\">\r\n          <h3 className=\"my-3\">{i18next.t('General settings')}</h3>\r\n          <form name=\"clientForm\" onSubmit={updateClient}>\r\n            <h2 className=\"mb-4\">{i18next.t('Organization information')}</h2>\r\n            <InputWithIcon\r\n              hasToBeFilled\r\n              icon=\"bi bi-caret-right-fill\"\r\n              label=\"Name\"\r\n              value={client.name}\r\n              onChange={onClientNameChange}\r\n            />\r\n            <EmailInput\r\n              isCorrectlyFilled={isValidEmail}\r\n              icon=\"bi bi-envelope-fill\"\r\n              label=\"Contact e-mail\"\r\n              value={client.contact_email}\r\n              onChange={onClientMailChange}\r\n              title={emailWarningMessage}\r\n            />\r\n            {/* {isInvalidEmail && (\r\n              <div className=\"text-danger\">\r\n                <p className=\"d-flex justify-content-center\" style={{ color: 'red' }}>\r\n                  {i18next.t('You must enter a valid e-mail address')}\r\n                </p>\r\n              </div>\r\n            )} */}\r\n            <h2 className=\"mb-4\">{i18next.t('Sharing statistics')}</h2>\r\n            <Select\r\n              icon=\"bi bi-bar-chart-fill\"\r\n              label=\"Do you agree to share the statistics ?\"\r\n              value={client.stats.toString()}\r\n              onChange={onShareStatsChange}\r\n              options={options}\r\n            />\r\n            <div className=\"form-group mt-4\">\r\n              <button\r\n                className=\"btn btn-primary\"\r\n                disabled={client.name === '' || client.contact_email === '' || !isValidEmail}\r\n              >\r\n                {i18next.t('Update settings')}\r\n              </button>\r\n            </div>\r\n          </form>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default ClientSettings"],"mappings":";;;;;;;;;;;;;;AAQA,IAAMA,cAAc,GAAG,SAAjBA,cAAcA,CAAA,EAAS;EAE3B,IAAMC,UAAU,GAAGC,YAAY,CAACC,OAAO,CAAC,eAAe,CAAC;EACxD,IAAIC,KAAK;EACT,IAAIH,UAAU,KAAK,IAAI,EAAE;IACxBG,KAAK,GAAGH,UAAU,CAACI,OAAO,CAAC,IAAI,EAAE,EAAE,CAAC;EACrC;EAEA,IAAMC,OAAO,GAAG,CACd;IAAEC,KAAK,EAAE,MAAM;IAAEC,WAAW,EAAE;EAAU,CAAC,EACzC;IAAED,KAAK,EAAE,OAAO;IAAEC,WAAW,EAAE;EAAgB,CAAC,CACjD;EAED,IAAAC,eAAA,GAA4BC,KAAK,CAACC,QAAQ,CAAS;MACjDC,aAAa,EAAE,EAAE;MACjBC,EAAE,EAAE,CAAC;MACLC,QAAQ,EAAE,CAAC;MACXC,IAAI,EAAE,EAAE;MACRC,KAAK,EAAE;IACT,CAAC,CAAC;IAAAC,gBAAA,GAAAC,cAAA,CAAAT,eAAA;IANKU,MAAM,GAAAF,gBAAA;IAAEG,SAAS,GAAAH,gBAAA;EAQxB,IAAMI,UAAU,GAAG,IAAIC,MAAM,CAAC,uEAAuE,CAAC;EACtG,IAAMC,eAAe,GAAG,IAAID,MAAM,CAAC,iBAAiB,CAAC;EAIrD,IAAAE,gBAAA,GAAwCd,KAAK,CAACC,QAAQ,CAAC,IAAI,CAAC;IAAAc,gBAAA,GAAAP,cAAA,CAAAM,gBAAA;IAArDE,YAAY,GAAAD,gBAAA;IAAEE,eAAe,GAAAF,gBAAA;EACpC,IAAAG,gBAAA,GAAsDlB,KAAK,CAACC,QAAQ,CAAC,EAAE,CAAC;IAAAkB,gBAAA,GAAAX,cAAA,CAAAU,gBAAA;IAAjEE,mBAAmB,GAAAD,gBAAA;IAAEE,sBAAsB,GAAAF,gBAAA;EAIlDnB,KAAK,CAACsB,SAAS,CAAC,YAAM;IACxB;AACA;;IAEI,IAAIb,MAAM,CAACP,aAAa,KAAK,EAAE,EAAE;MAC/Be,eAAe,CAAC,KAAK,CAAC;MACtBI,sBAAsB,CAAC,4BAA4B,CAAC;IACtD,CAAC,MACI;MACH,IAAIV,UAAU,CAACY,IAAI,CAACd,MAAM,CAACP,aAAa,CAAC,EAAE;QACzCe,eAAe,CAAC,IAAI,CAAC;QACrBI,sBAAsB,CAAC,EAAE,CAAC;MAC5B,CAAC,MACI;QACHJ,eAAe,CAAC,KAAK,CAAC;QAC9B;AACA;QACQ,IAAIR,MAAM,CAACP,aAAa,CAACsB,QAAQ,CAAC,GAAG,CAAC,EAAE;UACtC,IAAIf,MAAM,CAACP,aAAa,CAACuB,KAAK,CAAC,CAAC,CAAC,CAAC,KAAK,GAAG,EAAE;YAC1CJ,sBAAsB,wCAAAK,MAAA,CAA2CjB,MAAM,CAACP,aAAa,mBAAiB,CAAC;UACzG,CAAC,MACI,IAAGO,MAAM,CAACP,aAAa,CAACuB,KAAK,CAAC,CAAC,CAAC,CAAC,KAAK,GAAG,EAAC;YAC7C,IAAME,UAAU,GAAGlB,MAAM,CAACP,aAAa,CAAC0B,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;YACrDP,sBAAsB,wCAAAK,MAAA,CAA2CC,UAAU,MAAI,CAAC;UAClF,CAAC,MACI,IAAG,CAACd,eAAe,CAACU,IAAI,CAACd,MAAM,CAACP,aAAa,CAAC0B,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,EAAC;YAChE,IAAMD,WAAU,GAAGlB,MAAM,CAACP,aAAa,CAAC0B,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;YACrD,IAAMC,qBAAqB,GAAGF,WAAU,CAACG,KAAK,CAAC,eAAe,CAAC;YAC/D,IAAIC,gBAAgB;YACpB,IAAIF,qBAAqB,KAAK,IAAI,EAAE;cACjCE,gBAAgB,GAAGF,qBAAqB,CAAC,CAAC,CAAC;cAC5C;YACF;YAAaR,sBAAsB,wDAAAK,MAAA,CAA2DK,gBAAgB,MAAI,CAAC;UACrH;QACF,CAAC,MACI;UACHV,sBAAsB,gDAAAK,MAAA,CAAmDjB,MAAM,CAACP,aAAa,yBAAyB,CAAC;QACzH;MACF;IACF;EAEF,CAAC,EAAE,CAACO,MAAM,CAACP,aAAa,CAAC,CAAC;EAG1B,SAAS8B,YAAYA,CAAA,EAAG;IACtB,IAAIvB,MAAM,CAACN,EAAE,GAAG,CAAC,EAAE;MACjB,IAAM8B,OAAO,GAAG;QACd,QAAQ,EAAE,mCAAmC;QAC7C,cAAc,EAAE;MAClB,CAAC;MAED,IAAIvC,KAAK,KAAK,IAAI,EAAE;QAClBuC,OAAO,CAAC,OAAO,CAAC,GAAGvC,KAAK;MAC1B;MAEAwC,KAAK,CAAC,aAAa,GAAGzB,MAAM,CAACN,EAAE,EAAE;QAC/BgC,MAAM,EAAE,OAAO;QACfF,OAAO,EAAPA,OAAO;QACPG,IAAI,EAAEC,IAAI,CAACC,SAAS,CAAC7B,MAAM;MAC7B,CAAC,CAAC,SACM,CAAC,UAAA8B,KAAK,EAAI;QACdC,OAAO,CAACD,KAAK,CAACA,KAAK,CAAC;MACtB,CAAC,CAAC;MAEJL,KAAK,CAAC,6BAA6B,EAAE;QACnCC,MAAM,EAAE,OAAO;QACfF,OAAO,EAAPA,OAAO;QACPG,IAAI,EAAEC,IAAI,CAACC,SAAS,CAAC;UAAEG,kBAAkB,EAAEhC,MAAM,CAACH;QAAM,CAAC;MAC3D,CAAC,CAAC,SACM,CAAC,UAAAiC,KAAK,EAAI;QACdC,OAAO,CAACD,KAAK,CAACA,KAAK,CAAC;MACtB,CAAC,CAAC;IACN;EACF;EAEA,SAASG,kBAAkBA,CAACC,KAAK,EAAE;IACjCjC,SAAS,CAAAkC,aAAA,CAAAA,aAAA,KAAMnC,MAAM;MAAEJ,IAAI,EAAEsC,KAAK,CAACE,MAAM,CAAChD;IAAK,EAAE,CAAC;EACpD;EAEA,SAASiD,kBAAkBA,CAACH,KAAK,EAAE;IACjCjC,SAAS,CAAAkC,aAAA,CAAAA,aAAA,KAAMnC,MAAM;MAAEP,aAAa,EAAEyC,KAAK,CAACE,MAAM,CAAChD;IAAK,EAAE,CAAC;EAC7D;EAEA,SAASkD,kBAAkBA,CAACJ,KAAK,EAAE;IACjCjC,SAAS,CAAAkC,aAAA,CAAAA,aAAA,KAAMnC,MAAM;MAAEH,KAAK,EAAE+B,IAAI,CAACW,KAAK,CAACL,KAAK,CAACE,MAAM,CAAChD,KAAK;IAAC,EAAE,CAAC;EACjE;EAEAG,KAAK,CAACsB,SAAS,CAAC,YAAM;IACxB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;IAGI,IAAI2B,cAAc;IAElB,IAAMhB,OAAO,GAAG,CAAC,CAAC;IAClB,IAAGvC,KAAK,KAAK,IAAI,EAAC;MACtBuC,OAAO,CAAC,OAAO,CAAC,GAAGvC,KAAK;IACpB;IAEA,IAAMwD,eAAe,GAAGhB,KAAK,CAAC,YAAY,EAAE;MAC1CD,OAAO,EAAPA;IACF,CAAC,CAAC,CACCkB,IAAI,CAAC,UAAAC,QAAQ;MAAA,OAAIA,QAAQ,CAACC,IAAI,CAAC,CAAC;IAAA,EAAC,CACjCF,IAAI,CAAC,UAAAG,IAAI,EAAI;MACZ,IAAMC,MAAM,GAAGD,IAAI,CAACE,OAAO,CAAC,CAAC,CAAC;MAC9BP,cAAc,GAAAL,aAAA,CAAAA,aAAA,KAAQK,cAAc,GAAKM,MAAM,CAAC;IAClD,CAAC,CAAC,SACI,CAAC,UAAAhB,KAAK;MAAA,OAAIC,OAAO,CAACD,KAAK,CAACA,KAAK,CAAC;IAAA,EAAC;IAEvC,IAAMkB,UAAU,GAAGvB,KAAK,CAAC,6BAA6B,EAAE;MACtDD,OAAO,EAAPA;IACF,CAAC,CAAC,CACCkB,IAAI,CAAC,UAAAC,QAAQ;MAAA,OAAIA,QAAQ,CAACC,IAAI,CAAC,CAAC;IAAA,EAAC,CACjCF,IAAI,CAAC,UAAAG,IAAI,EAAI;MACZ,IAAMhD,KAAK,GAAGgD,IAAI,CAACA,IAAI,CAACb,kBAAkB;MAC1CQ,cAAc,GAAAL,aAAA,CAAAA,aAAA,KAAQK,cAAc;QAAE3C,KAAK,EAALA;MAAK,EAAE;IAC/C,CAAC,CAAC,SACI,CAAC,UAAAiC,KAAK;MAAA,OAAIC,OAAO,CAACD,KAAK,CAACA,KAAK,CAAC;IAAA,EAAC;IAEvCmB,OAAO,CAACC,GAAG,CAAC,CAACT,eAAe,EAAEO,UAAU,CAAC,CAAC,CACvCN,IAAI,CAAC,YAAM;MACVzC,SAAS,CAACuC,cAAc,CAAC;IAC3B,CAAC,CAAC;EACN,CAAC,EAAE,EAAE,CAAC;EAGN,oBACEjD,KAAA,CAAA4D,aAAA;IAAKC,SAAS,EAAC;EAAK,gBAClB7D,KAAA,CAAA4D,aAAA;IAAKC,SAAS,EAAC;EAAM,gBACnB7D,KAAA,CAAA4D,aAAA;IAAKC,SAAS,EAAC;EAAW,gBACxB7D,KAAA,CAAA4D,aAAA;IAAIC,SAAS,EAAC;EAAM,GAAEC,OAAO,CAACC,CAAC,CAAC,kBAAkB,CAAM,CAAC,eACzD/D,KAAA,CAAA4D,aAAA;IAAMvD,IAAI,EAAC,YAAY;IAAC2D,QAAQ,EAAEhC;EAAa,gBAC7ChC,KAAA,CAAA4D,aAAA;IAAIC,SAAS,EAAC;EAAM,GAAEC,OAAO,CAACC,CAAC,CAAC,0BAA0B,CAAM,CAAC,eACjE/D,KAAA,CAAA4D,aAAA,CAACK,aAAa;IACZC,aAAa;IACbC,IAAI,EAAC,wBAAwB;IAC7BC,KAAK,EAAC,MAAM;IACZvE,KAAK,EAAEY,MAAM,CAACJ,IAAK;IACnBgE,QAAQ,EAAE3B;EAAmB,CAC9B,CAAC,eACF1C,KAAA,CAAA4D,aAAA,CAACU,UAAU;IACTC,iBAAiB,EAAEvD,YAAa;IAChCmD,IAAI,EAAC,qBAAqB;IAC1BC,KAAK,EAAC,gBAAgB;IACtBvE,KAAK,EAAEY,MAAM,CAACP,aAAc;IAC5BmE,QAAQ,EAAEvB,kBAAmB;IAC7B0B,KAAK,EAAEpD;EAAoB,CAC5B,CAAC,eAQFpB,KAAA,CAAA4D,aAAA;IAAIC,SAAS,EAAC;EAAM,GAAEC,OAAO,CAACC,CAAC,CAAC,oBAAoB,CAAM,CAAC,eAC3D/D,KAAA,CAAA4D,aAAA,CAACa,MAAM;IACLN,IAAI,EAAC,sBAAsB;IAC3BC,KAAK,EAAC,wCAAwC;IAC9CvE,KAAK,EAAEY,MAAM,CAACH,KAAK,CAACoE,QAAQ,CAAC,CAAE;IAC/BL,QAAQ,EAAEtB,kBAAmB;IAC7BnD,OAAO,EAAEA;EAAQ,CAClB,CAAC,eACFI,KAAA,CAAA4D,aAAA;IAAKC,SAAS,EAAC;EAAiB,gBAC9B7D,KAAA,CAAA4D,aAAA;IACEC,SAAS,EAAC,iBAAiB;IAC3Bc,QAAQ,EAAElE,MAAM,CAACJ,IAAI,KAAK,EAAE,IAAII,MAAM,CAACP,aAAa,KAAK,EAAE,IAAI,CAACc;EAAa,GAE5E8C,OAAO,CAACC,CAAC,CAAC,iBAAiB,CACtB,CACL,CACD,CACH,CACF,CACF,CAAC;AAEV,CAAC"}